#cloud-config

apt_update: true
apt_upgrade: true
packages:
  - rabbitmq-server
byobu_default: system

write_files:
  - path: /home/ubuntu/get_ip.sh
    content: |
      #!/bin/bash
      echo "export LOCAL_IP=`ifconfig eth0 | grep 'inet addr:' | cut -d: -f2 | awk '{ print $1}'`" >> /home/ubuntu/.bashrc
      source /home/ubuntu/.bashrc
    
runcmd:
  - sudo rabbitmqctl add_user ubuntu group9
  - sudo rabbitmqctl set_permissions ubuntu ".*" ".*" ".*"
  - bash -x /home/ubuntu/get_ip.sh
